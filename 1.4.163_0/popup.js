var mobiles = [{
    "product": "Auto buy Redmi 5 on Mi",
    "varients": [{
        "varient": "2GB 16GB",
        "stores": [{
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mi5mi", "4180500033", "Black", "black", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500035", "Gold", "#EBDBAE", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500037", "Lake Blue", "#bfe3f3", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500039", "Rose Gold", "#f9ccc9", "03 20 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "3GB 32GB",
        "stores": [{
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mi5mi", "4180500034", "Black", "black", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500036", "Gold", "#EBDBAE", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500038", "Lake Blue", "#bfe3f3", "03 20 2018 12:00:00"],
                ["mi5mi", "4180500040", "Rose Gold", "#f9ccc9", "03 20 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "4GB 64GB",
        "stores": [{
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mi5mi", "4181100018", "Black", "black", "03 20 2018 12:00:00"],
                ["mi5mi", "4181100019", "Gold", "#EBDBAE", "03 20 2018 12:00:00"],
                ["mi5mi", "4181100020", "Lake Blue", "#bfe3f3", "03 20 2018 12:00:00"],
                ["mi5mi", "4181100021", "Rose Gold", "#f9ccc9", "03 20 2018 12:00:00"]
            ]
        }]
    }]
},{
    "product": "Auto buy Redmi Note 5",
    "varients": [{
        "varient": "3GB 32GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["min5b", "min5b", "Black", "black", "02 22 2018 12:00:00"],
                ["min5g", "min5g", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5lb", "min5lb", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5rg", "min5rg", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["min5mi", "4180500026", "Black", "black", "02 22 2018 12:00:00"],
                ["min5mi", "4180500028", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5mi", "4180500030", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5mi", "4180500032", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "4GB 64GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["min5b2", "min5b2", "Black", "black", "02 22 2018 12:00:00"],
                ["min5g2", "min5g2", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5lb2", "min5lb2", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5rg2", "min5rg2", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["min5mi", "4180500025", "Black", "black", "02 22 2018 12:00:00"],
                ["min5mi", "4180500027", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5mi", "4180500029", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5mi", "4180500031", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }]
    }]
},{
    "product": "Auto buy Redmi Note 5 Pro",
    "varients": [{
        "varient": "4GB 64GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["min5pb", "min5pb", "Black", "black", "02 22 2018 12:00:00"],
                ["min5pg", "min5pg", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5plb", "min5plb", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5prg", "min5prg", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["min5mi", "4180500017", "Black", "black", "02 22 2018 12:00:00"],
                ["min5mi", "4180500019", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5mi", "4180500021", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5mi", "4180500023", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "6GB 64GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["min5pb2", "min5pb2", "Black", "black", "02 22 2018 12:00:00"],
                ["min5pg2", "min5pg2", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5plb2", "min5plb2", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5prg2", "min5prg2", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["min5mi", "4180500018", "Black", "black", "02 22 2018 12:00:00"],
                ["min5mi", "4180500020", "Gold", "#EBDBAE", "02 22 2018 12:00:00"],
                ["min5mi", "4180500022", "Lake Blue", "#bfe3f3", "02 22 2018 12:00:00"],
                ["min5mi", "4180500024", "Rose Gold", "#f9ccc9", "02 22 2018 12:00:00"]
            ]
        }]
    }]
},{
    "product": "Mi LED Smart TV",
    "varients": [{
        "varient": "TV 4, 55 In",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["mistv4b", "mistv4b", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mistv4", "4174700006", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "TV 4A, 43 In",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["mistv4a43b", "mistv4a43b", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mistv4", "4174700008", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }]
    },{
        "varient": "TV 4A, 32 In",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["mistv4a32b", "mistv4a32b", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mistv4", "4174700007", "Black", "black", "03 13 2018 12:00:00"]
            ]
        }]
    }]
}, {
    "product": "Auto buy Honor 9 Lite",
    "varients": [{
        "varient": "4GB 64GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["hn9l4blu", "hn9l4blu", "Blue", "blue", "02 06 2018 12:00:00"],
                ["hn9l4gr", "hn9l4gr", "Grey", "grey", "02 06 2018 12:00:00"],
                ["hn9l4blc", "hn9l4blc", "Black", "black", "02 06 2018 12:00:00"]
            ]
        }]
    }, {
        "varient": "3GB 32GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["hn9l3blu", "hn9l3blu", "Blue", "blue", "02 06 2018 12:00:00"],
                ["hn9l3gr", "hn9l3gr", "Grey", "grey", "02 06 2018 12:00:00"],
                ["hn9l3blc", "hn9l3blc", "Black", "black", "02 06 2018 12:00:00"]
            ]
        }]
    }]
}, {
    "product": "Auto buy Redmi 5a",
    "varients": [{
        "varient": "2GB 16GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["mi5ago", "mi5ago", "Gold", "#ebdbae", "02 23 2017 12:00:00"],
                ["mi5agr", "mi5agr", "Grey", "grey", "12 15 2017 12:00:00"],
                ["mi5arg", "mi5arg", "Rose Gold", "#b76e79", "12 15 2017 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mi5a", "4174600001", "Gold", "#ebdbae", "12 15 2017 12:00:00"],
                ["mi5a", "4174600002", "Grey", "grey", "12 15 2017 12:00:00"],
                ["mi5a", "4174600003", "Rose Gold", "#b76e79", "12 15 2017 12:00:00"]
            ]
        }]
    }, {
        "varient": "3GB 32GB",
        "stores": [{
            "store": "flipkart",
            "logo": "flipkart.jpg",
            "colors": [
                ["mi5ago2", "mi5ago2", "Gold", "#ebdbae", "12 15 2017 12:00:00"],
                ["mi5agr2", "mi5agr2", "Grey", "grey", "12 15 2017 12:00:00"],
                ["mi5arg2", "mi5arg2", "Rose Gold", "#b76e79", "12 15 2017 12:00:00"]
            ]
        }, {
            "store": "mi",
            "logo": "mi.jpg",
            "colors": [
                ["mi5a", "4174600004", "Gold", "#ebdbae", "12 15 2017 12:00:00"],
                ["mi5a", "4174600005", "Grey", "grey", "12 15 2017 12:00:00"],
                ["mi5a", "4174600006", "Rose Gold", "#b76e79", "12 15 2017 12:00:00"]
            ]
        }]
    }]
}];
var stri = '<div class="box"><div class="autobuy_box" style="display: flex;"><div class="content" style="width: 100%;height: 32px;"> <label for="fkoco" class="content_text">Auto Checkout on Flipkart <a target="_blank" href="https://flipshope.com/blog/flipkart-flash-sale-auto-check-out/" style="font-family: -webkit-pictograph;cursor: alias;">Know more</a></label><input class="special " type="checkbox" name="fkoco" id="fkoco"><label class="special" for="fkoco"></label></div></div></div><div class="container"><div class="mobile_name">Autobuy Redmi 5 on Amazon</div><div class="sec_cont"><div style="    width: 100%;    height: 35px;"><div class="varient" style="    width: 100%;"><div class="var_inner">Download Amazon Autobuy extension <a href="https://bit.ly/amz4a" target="_blank"><b>from here</b></a></div></div></div></div></div></div>';
stri = '<div class="container"><div class="mobile_name">Auto Checkout on Flipkart <a target="_blank" href="https://flipshope.com/blog/flipkart-flash-sale-auto-check-out/" style="font-family: -webkit-pictograph;cursor: alias;">Know more</a></div><div class="sec_cont" style=""><div class="content" style="width: 50%;font-size: 15px;height: 20px;box-shadow: 1px 0px 3px -1px rgba(0,0,0,0.3);"> <label for="fkoco" class="content_text">Without Payment</label><input class="special " type="checkbox" name="fkoco" id="fkoco"><label class="special" for="fkoco" style="    top: -6px;"></label></div><div class="content" style="width: 50%;height: 20px;font-size: 15px;"> <label for="fkoco2" class="content_text">PhonePay / UPI</label><input class="special " type="checkbox" name="fkoco2" id="fkoco2"><label class="special" for="fkoco2" style="    top: -6px;"></label></div></div></div>';

var islogin = 0;
for (var i = 0; i < mobiles.length; i++) {
    stri += '<div class="container"><div class="mobile_name">' + mobiles[i]['product'] + '</div>';
    for (var j = 0; j < mobiles[i]['varients'].length; j++) {
        stri += '<div class="sec_cont"><div><div class="varient"><div class="var_inner">' + mobiles[i]['varients'][j]['varient'] + '</div></div></div><div class="thrd_cont">';
        for (var k = 0; k < mobiles[i]['varients'][j]["stores"].length; k++) {
            stri += '<div class="img_outer"><div class="img_inner"><img src="images/' + mobiles[i]['varients'][j]["stores"][k]["logo"] + '" class="site_logo"></div><div class="colors">';
            for (var l = 0; l < mobiles[i]['varients'][j]["stores"][k]["colors"].length; l++) {
                var ll = 100 / mobiles[i]['varients'][j]["stores"][k]["colors"].length;
                stri += '<div class="color_cont" style="width:' + ll + '%"><div style="z-index: 1;position: absolute;font-size: 10px;">' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][2] + '</div><div class="color" style="background:' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][3] + '"><input class="special" type="checkbox" name="' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][0] + '" value="' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][1] + '" id="' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][1] + '"><label class="special new" for="' + mobiles[i]['varients'][j]["stores"][k]["colors"][l][1] + '"></label></div></div>';
                /* title="'+mobiles[i]['varients'][j]["stores"][k]["colors"][l][2]+'" */
            }
            stri += "</div></div>";
        }
        stri += "</div></div>";
    }
    stri += "</div>";
}
/*
for (var i = mobiles.length - 1; i >= 0; i--) {
    if(mobiles[i][0] == "fkoco") stri = '<div class="box"><div class="autobuy_box" style="display: flex;"><div class="content" style="width: 100%;height: 32px;"> <label for="fkoco" class="content_text">Auto Checkout on Flipkart <a target="_blank" href="http://flipshope.com/blog/flipkart-flash-sale-auto-check-out/" style="font-family: -webkit-pictograph;cursor: alias;">Know more</a></label><input class="special " type="checkbox" name="fkoco" id="fkoco"><label class="special" for="fkoco"></label></div></div></div>'+stri;
    else stri += '
        //stri += '<div class="box"><div class="autobuy_box" style="display: flex;"><div class="box_img" ><img class="auto_img" src="images/mobiles/'+mobiles[i][4]+'"></div><div class="content"> <label for="'+mobiles[i][1]+'" class="content_text" >'+mobiles[i][3]+'</label>        <input class="special " type="checkbox" name="'+mobiles[i][0]+'" value="'+mobiles[i][1]+'" id="'+mobiles[i][1]+'" /><label  class="special" for="'+mobiles[i][1]+'"></label></div></div></div>'
	 //<label class="bl" id="'+mobiles[i][0]+'lb" style="color: chocolate;font-weight: 600;text-decoration: inherit; padding-left: 4px;"><input type="checkbox" name="checkbox" id="'+mobiles[i][0]+'" value="yes">'+mobiles[i][2]+'</label>';
}
*/
var div = document.getElementById('abuy');
div.innerHTML = div.innerHTML + stri;
for (var i = 0; i < mobiles.length; i++) {
    for (var j = 0; j < mobiles[i]['varients'].length; j++) {
        for (var k = 0; k < mobiles[i]['varients'][j]["stores"].length; k++) {
            for (var l = 0; l < mobiles[i]['varients'][j]["stores"][k]["colors"].length; l++) {
                var thiscook = mobiles[i]['varients'][j]["stores"][k]["colors"][l][0];
                var thiscookv = mobiles[i]['varients'][j]["stores"][k]["colors"][l][1];
                if (getCookie(thiscook) && document.getElementById(getCookie(thiscook))) document.getElementById(getCookie(thiscook)).checked = true;
                addClickHandler(document.getElementById(thiscookv), thiscook, thiscookv, mobiles[i]['varients'][j]["stores"][k]["colors"][l][4]);
            }
        }
    }
}
if (getCookie("fkoco") && document.getElementById(getCookie("fkoco"))) document.getElementById(getCookie("fkoco")).checked = true;
addClickHandler(document.getElementById("fkoco"), "fkoco", "fkoco", "flipkart_mobiles");
addClickHandler(document.getElementById("fkoco2"), "fkoco", "fkoco2", "flipkart_mobiles_phonpay");
function addClickHandler(elem, cookiename, mobile, date) {
    elem.addEventListener('click', function(e) {
        date = new Date(date).getTime();
        if (document.getElementById(mobile).checked) {
            document.cookie = cookiename + "=" + mobile + ";expires=" + new Date(getnextdate(date) + 120000);
            ga('send', 'event', 'autobuy', 'check', mobile);
            setTimeout(function() {
                window.close();
                chrome.tabs.reload();
            }, 1000);
        }
        if (!document.getElementById(mobile).checked) {
            document.cookie = cookiename + "=No;expires=" + new Date(1000);
            ga('send', 'event', 'autobuy', 'uncheck', mobile);
        }
    }, false);
}
var letv = new Date("6 14 2016 14:00:00").getTime();
var mireg = new Date("3 9 2016 14:00:00").getTime();
var lemallreg = new Date("6 20 2016 12:00:00").getTime();


function getnextdate(sdate) {
    var cdate = new Date().getTime();
    while (cdate > sdate) sdate = sdate + 7 * 24 * 60 * 60000;
    return sdate;
}

function pause() {
    if (localStorage["pause"] == "false") {
        localStorage["pause"] = "true";
        document.getElementById("pause").innerHTML = "Resume FlipShope";
    } else {
        localStorage["pause"] = "false";
        document.getElementById("pause").innerHTML = "Pause FlipShope";
    }
    window.close();
    chrome.tabs.reload();
}
$('.foot_opt').click(function() {
    if ($(this).hasClass('foot_opt_act')) return;
    $('.menu_content').removeClass('visible');
    var id = '#' + $(this).attr('for');
    $(id).addClass('visible');
    $('.foot_opt').removeClass('foot_opt_act');
    $(this).addClass('foot_opt_act');
    ga('send', 'event', 'extension popup', 'tab click', id);
});
var user_container = '<div class="box"> <div id="user_btns"> <div id="div_8d91_7"><div class="toggle active" id="signup_btn" href="/main/profile/auth/join">Join Flipshope</div><div class="div_8d91_8"></div></div><div id="div_8d91_9"><div class="toggle" id="login_btn" href="/main/profile/auth/login">Log In</div></div></div><div id="user_form"> </div></div>';
var login_form = '<div id="ex_foot1"> <h2 id="h2_8d91_0">Welcome back, friend.</h2><button id="fbbtn" class="fgbtns fb-login-button"><i class="fa fa-facebook-f i_8d91_0" ></i><span >Facebook</span></button><button id="gpbtn" class="fgbtns gp-login-button"><i class="fa fa-google-plus i_8d91_0" ></i><span >Google+</span></button> <div id="ex_foot2">- or -</div><form  id="login_form" clsss="form_8d91_0" name="login"> <div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="Email" class="input" name="credential" type="email"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="Password" class="input" name="password" type="password"><div class="error" style="position: initial;"></div> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><input type="submit" value="Login with Email" class="button_8d91_2"></form><div class="ext_fp" id="goto_fp"> Forgot password/ Resend Activation link<img src="images/arrow.png"  class="ext_fp_img"></div></div>';
var signup_form = '<div id="ex_foot1"> <h2 id="h2_8d91_0"></h2><button id="fbbtn" class="fgbtns fb-login-button"><i class="fa fa-facebook-f i_8d91_0" ></i><span >Facebook</span></button><button id="gpbtn" class="fgbtns gp-login-button"><i class="fa fa-google-plus i_8d91_0" ></i><span >Google+</span></button> <div id="ex_foot2">- or -</div><form id="signup_form" class="form_8d91_0" name="signup"><div style="color: green;size: 16px;font-size: 15px;">Not required for autobuy, OTP service might not work due to some maintenance activity</div><div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="Email" class="input" name="email" type="email"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3 left_half_ex_foot3"> <div class="input_div left_half_input_div"><label class="input_lbl"></label><input placeholder="Full Name" class="input" name="name" type="text"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3 right_half_ex_foot3"> <div class="input_div right_half_input_div"><label class="input_lbl"></label><input placeholder="Mobile" class="input" name="mobile" type="text"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3 left_half_ex_foot3"> <div class="input_div left_half_input_div"><label class="input_lbl"></label><input id="su_password" placeholder="Password" class="input" name="password" type="password"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3 right_half_ex_foot3"> <div class="input_div right_half_input_div"><label class="input_lbl"></label><input placeholder="Confirm Password" class="input" name="cpassword" type="password"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><input type="submit" value="Sign up with Email" class="button_8d91_2"></form> </div>';
var fp_form = '<div id="ex_foot1"> <h2 id="h2_8d91_0">Forgot Password</h2> <form id="fp_form" clsss="form_8d91_0" name="fp_form" novalidate="novalidate"> <div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="Email" class="input valid" name="email" type="email"> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="success" style="position: initial;margin-top: 15px;"></div><div class="error" style="position: initial;margin-top: 15px;"></div><input type="submit" value="Change password" class="button_8d91_2"></form><div class="ext_fp" id="goto_lp"> Back to Login<img src="images/arrow.png" class="ext_fp_img"></div></div>'
var ver_form = '<div id="ex_foot1"> <h2 id="h2_8d91_0">Verify Your Mobile Number</h2> <form id="ver_form" clsss="form_8d91_0" name="ver_form" novalidate="novalidate"> <div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="Mobile Number" id="mobile_no_input_field" class="input valid" name="phoneNo" type="text"><a href="#" id="change_mobile" style="float: right;margin-top: -42px;font-size: 13px;position: relative;">Change</a> <div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="ex_foot3"> <div class="input_div"><label class="input_lbl"></label><input placeholder="OTP" class="input valid" name="otp" type="text"><a href="#" id="resend_otp" style="float: right;margin-top: -42px;font-size: 13px;position: relative;">Resend OTP</a><div> <hr class="hr0"> <hr class="hr1"> </div></div></div><div class="success" style="position: initial;margin-top: 15px;"></div><div class="error" style="position: initial;margin-top: 15px;"></div><input type="submit" value="Verify Mobile" class="button_8d91_2"></form><div class="ext_fp" id="goto_lp"> Logout <img src="images/arrow.png" class="ext_fp_img"></div></div>'
var email_not_vali = '<div class="f_about"><br><br><br><span style="line-height: 25px;">Your email id is not verfied, Please verify your email id by the verification mail you got at the time of registration <div id="ex_foot2">- or -</div> <form clsss="form_8d91_0" id="email_not_vali"><div class="success" style="position: initial;margin-top: 15px;"></div><div class="error" style="position: initial;margin-top: 15px;"></div><input type="submit" style="width: 100%;" value="Resend verification mail" class="button_8d91_2"></form><br></span></div></div>'
$('#user').html(user_container);
$('#user_form').html(signup_form);
signup_validate();
checklogin();
$('#user_btns .toggle').click(function() {
    if ($(this).hasClass('active')) return;
    $('#user_btns .toggle').toggleClass('active');
    if ($(this).attr('id') == 'signup_btn') {
        $('#user_form').html(signup_form);
        signup_validate();
    } else {
        $('#user_form').html(login_form);
        login_validate();
    }
});
$("#user_form").on('click', '#goto_fp', function() {
    $('#user_form').html(fp_form);
    fp_validate();
});
$("#user_form").on('click', '#goto_lp', function() {
    $('#user_form').html(login_form);
    login_validate();
});
$('body').on('click', '#fbbtn', function() {
    chrome.tabs.create({
        url: 'https://flipshope.com/fb_login/?close_after_login=1',
        active: false
    }, function(tab) {
        // After the tab has been created, open a window to inject the tab
        chrome.windows.create({
            tabId: tab.id,
            type: 'popup',
            focused: true
            // incognito, top, left, ...
        });
    });
});
$('body').on('click', '#gpbtn', function() {
    chrome.tabs.create({
        url: 'https://flipshope.com/google_login/?close_after_login=1',
        active: false
    }, function(tab) {
        // After the tab has been created, open a window to inject the tab
        chrome.windows.create({
            tabId: tab.id,
            type: 'popup',
            focused: true
            // incognito, top, left, ...
        });
    });
});
var f_deals = '<div id="f_deals" class="f_menu_sub visible"> <h1>Deals &amp; Coupons</h1><img src="' + chrome.extension.getURL('images/coupons.jpg') + '"> <div class="f_about">About: <span>Are you the one who checks the newspaper for a ‘Buy 1 Get 1’ on Flipkart or a ‘Flat 50% off’ on Jabong? Then use our ‘Coupons and Deals’ feature to learn about the available coupons and exciting deals on several shopping websites at one place.</span></div></div>';
var f_autobuy = '<div id="f_autobuy" class="f_menu_sub visible"> <h1>Auto Buy</h1><img src="' + chrome.extension.getURL('images/autobuy.jpg') + '"> <div class="f_about">About: <span>With our ‘Auto Buy’ feature, you will be able to purchase any type of products under the limited period flash sale. All it requires is a pre-registration with Flipshope, and in a single click you make a purchase without any struggle.</span></div></div>';
var f_autocou = '<div id="f_autocou" class="f_menu_sub visible"> <h1>Auto Apply Coupons</h1><img src="' + chrome.extension.getURL('images/autocoupon.jpg') + '"> <div class="f_about">About: <span>This feature shows up while you are about to apply promo code or coupons, now with a single click on the ‘Auto Apply’ option, you can check the availability of all coupons and can get the least price with maximum discount.</span></div></div>';
var f_compare = '<div id="f_compare" class="f_menu_sub visible"> <h1>Compare</h1><img src="' + chrome.extension.getURL('images/compare.jpg') + '"> <div class="f_about">About: <span>This ‘money saver’ tool lends you a hand to shop within your budget. It presents you the price of a specific product from multiple shopping websites and hence aids in the comparison of those prices. </span></div></div>';
var f_graph = '<div id="f_graph" class="f_menu_sub visible"> <h1>Graph</h1><img src="' + chrome.extension.getURL('images/graph.jpg') + '"> <div class="f_about">About: <span>Looking for the right time to buy a product at its cheapest price? Our ‘Price Graph’ tool presents you the cost variations of a product over the past nine months and guides you on when to buy the product. </span></div></div>';
$('#features').append('<div class="box"> <div class="f_menu active" for="f_deals">Deals & Coupons</div><div class="div_8d91_8"></div><div class="f_menu"  for="f_autobuy">Autobuy</div><div class="div_8d91_8"></div><div class="f_menu" style="width: 100px;"  for="f_autocou">Auto Coupon Apply</div><div class="div_8d91_8"></div><div class="f_menu"  for="f_compare">Compare</div><div class="div_8d91_8"></div><div class="f_menu"  for="f_graph">Price Graph</div>' + f_deals + f_autobuy + f_autocou + f_compare + f_graph + '</div>');
$('#home').append('<div class="box"><div class="autobuy_box" style="display: flex;"><div class="box_img" style="box-shadow: none;"><img class="auto_img" src="' + chrome.extension.getURL('images/stars.png') + '"></div><div class="content"> <a href="http://bit.ly/flipshope" target="_blank" class="content_text" style=" color: gray; font-size: 17px;">Rate Us on Chrome Store</a></div></div></div><div class="box" style=" width: 45%; float: right; margin-top: 0;"><div class="autobuy_box" style="display: flex;float: left;"><div class="content" style=" width: 169px;"> <a href="https://flipshope.com/report/" target="_blank" class="content_text" style="margin: auto;">Report A problem</a></div></div></div><div class="box" style=" width: 45%;"><div class="autobuy_box" style="display: flex;float: left;"><div class="content" style=" width: 169px;"> <a href="https://flipshope.com/about/workwithus.php" target="_blank" class="content_text" style="color: #E91E63;font-size: 17px;margin: auto;">Work With Us</a></div></div></div><div class="box"><div style=" text-align: center; padding: 9px; font-size: 19px; color: #6c6c6c;"> Share Flipshope:</div><a href="http://www.addtoany.com/add_to/facebook?linkurl=flipshope.com&linkname=Flipshope&linknote=" class="popup"><button id="shrfb" class="fgbtns fb-login-button" style=" margin: 9px 15px; "><i class="fa fa-facebook-f i_8d91_0"></i><span>Facebook</span></button></a><a href="http://www.addtoany.com/add_to/google_plus?linkurl=flipshope.com&linkname=Flipshope&linknote=" class="popup"><button id="shrgp" class="fgbtns gp-login-button" style=" margin: 9px; margin: 9px 15px;"><i class="fa fa-google-plus i_8d91_0"></i><span>Google+</span></button></a><a href="http://www.addtoany.com/add_to/twitter?linkurl=flipshope.com&linkname=@FlipshopeCom&linknote=" class="popup"><button id="shrtw" class="fgbtns tw-button" style=" margin: 9px 110px;"><i class="fa fa-twitter i_8d91_0"></i><span>Twitter</span></button></a> </div>')
$('.f_menu').click(function() {
    if ($(this).hasClass('active')) return;
    $('.f_menu_sub').removeClass('visible');
    var id = '#' + $(this).attr('for');
    $(id).addClass('visible');
    $('.f_menu').removeClass('active');
    $(this).addClass('active');
});

setTimeout(function() {
    $.post("https://flipshope.com/extension/api/blog_posts.php", {
        posts: 2
    }).done(function(data) {
        var pstri = "";
        //data = JSON.parse(data); 
        //console.log(data); 
        for (var i = 0; i < data.length; i++) {
            pstri += '<div class="box"><div class="autobuy_box" style="display: flex;"><div class="box_img" ><img class="auto_img" src="' + data[i]['img_url'] + '"></div><div class="content"> <a href="' + data[i]['url'] + '" target="_blank" class="content_text" >' + data[i]['title'] + '</a></div></div></div>';
        }
        $('#home').prepend(pstri);
        //<label class="bl" id="'+mobiles[i][0]+'lb" style="color: chocolate;font-weight: 600;text-decoration: inherit; padding-left: 4px;"><input type="checkbox" name="checkbox" id="'+mobiles[i][0]+'" value="yes">'+mobiles[i][2]+'</label>';
    });
}, 1000);
$('.popup').click(function() {
    window.open(this.href, "", "location=center");
    return false;
});
chrome.tabs.onUpdated.addListener(function(tabId, changeInfo, tab) {
    var inc, hsts = 0;
    if (changeInfo.url) {
        if (changeInfo.url.indexOf("flipshope.com/login/close.html") !== -1) {
            checklogin();
            chrome.tabs.remove(tabId);
        }
    }
});
$(document).ready(function() {
    $("body").on('keyup', '.price-td', function(e) {
        if (e.which === 13) {
            $(this).blur();
            var eData = {};
            eData.pid = $(this).attr('data-pid');
            eData.store = $(this).attr('data-store');
            eData.userId = $(this).attr('data-userId');
            eData.price = $(this).text();
            chrome.runtime.sendMessage({
                sksmode: "createUserProductSubcription",
                data: eData
            }, function(response) {});
            ga('send', 'event', 'watch price', 'edit', JSON.stringify(eData));
        }
    });
});

$(document).ready(function() {
    $('body').on('click', 'a', function() {
        if ($(this).attr('href') && $(this).attr('href') != '#') {
            chrome.tabs.create({
                url: $(this).attr('href')
            });
            ga('send', 'event', 'open link', 'click', $(this).attr('href'));
        }
        return false;
    });
});

$(document).ready(function() {
    $('body').on('click', '.delete-subscription', function() {
        var dData = {};
        dData.pid = $(this).attr('data-pid');
        dData.userId = $(this).attr('data-userId');
        chrome.runtime.sendMessage({
            sksmode: "deleteUserProductSubscription",
            data: dData
        }, function(response) {
            if (response) {
                $('#tr-subscription-' + dData.pid).remove();
            }
        });
        ga('send', 'event', 'watch price', 'delete', JSON.stringify(dData));
    });
});

function fetchUserSubscriptions(userId) {
    var queryString = "?userId=" + encodeURIComponent(userId);
    var url = "https://flipshope.com/login/wp_api/fetchUserProductSubscriptions.php" + queryString;
    $.get(url).done(function(data) {
        data = JSON.parse(data);
        if (data.SUCCESS === true) {
            data = data.DATA;
            var sh = '<div style="text-align: center;padding-bottom: 10px;margin: -12px auto;font-size: 20px;width: 120px;background: #f9fbfd;color: #607D8B;">Watch Price</div>';
            if (data.length === 0) {
                sh += '<div class="no-subscribed-products-message" style="padding: 20px 0 26px 0;text-align: center;"">You haven\'t subscribed to any products yet! </div>';
                $("#subscribed_prod").append(sh);
                return;
            }
            for (var i = 0; i < data.length; ++i) {
                var alt;
                if (typeof(data[i].title) !== 'undefined' && data[i].title)
                    alt = data[i].title;
                else
                    alt = data[i]['url'].replace(/https?:\/\//i, "").substr(0, 20) + '...';
                sh += '<div id="tr-subscription-' + data[i].pid + '" class="box"><div class="autobuy_box" style="display: flex;"><div class="box_img"><img class="auto_img" src="' + data[i].image + '" alt="' + alt + '" title="' + alt + '"/></div><div class="content" style="display: inline-table;"><div class="box_break_text"><a href="' + data[i].url + '" target="_blank" class="content_text" title="' + alt + '">' + alt + '</a></div><div style="font-size: 15px;display: table-row-group;vertical-align: bottom;">Desired Price: <div style ="color: brown;cursor: pointer;width: 80px;display: -webkit-inline-box;" class="price-td" contenteditable="true" title="Click to change" data-pid="' + data[i].pid + '" data-store="' + data[i].store + '" data-userId="' + userId + '">' + data[i].price + ' </div><a href="#" class="delete-subscription" style="display: inline-table;float: right;" data-pid="' + data[i].pid + '" data-userId="' + userId + '">Delete</a></div></div></div></div>';
            }
            /*

                sh += '<tr id="tr-subscription-' + data[i].pid + '"><td><a href="' + data[i].url + '"><img src="' + data[i].image + '" alt="' + alt + '" title="' + alt + '"/><br><span>' + alt + '</span></a></td>';
                sh += '<td class="price-td" contenteditable="true" title="Click to change" data-pid="' + data[i].pid + '" data-store="' + data[i].store + '" data-userId="' + userId + '">' + data[i].price + '</td>';
                sh += '<td><a href="#" class="delete-subscription" data-pid="' + data[i].pid + '" data-userId="' + userId + '">Delete</a></td></tr>';
            }
            var sh = '<div class="box"><div class="autobuy_box" style="display: flex;"><div class="box_img"><img class="auto_img" src="https://flipshope.com/blog/wp-content/uploads/2017/06/amazon-Nokia-6-next-sale-date.png"></div><div class="content" style="height: 80px;display: inline-table;"> <a href="https://flipshope.com/blog/?p=8792" target="_blank" class="content_text">Nokia 6 Next Sale Date on Amazon First Sale Date</a><div style="font-size: 15px;display: table-row-group;vertical-align: bottom;"> Desired Price : 200000    <div style="    display: inline-table;    float: right;">Delete</div></div></div><div> Desired Price : 200000</div></div></div>';
            /*
            var sh = '<div id="subscribed-products-div"><div class="luser_subbox_table"><table class="subscribed-products-table">';
            sh += '<tr><th><h3 class="luser_h3_l">Product</h3></th><th><h3 class="luser_h3_l">Desired Price</h3></th><th></th></tr>';
            if(data.length === 0) {
                sh += '</tr></table>';
                sh += '<span class="no-subscribed-products-message">';
                sh += 'You haven\'t subscribed to any products yet!';
                sh += '</span><br>&nbsp;</div></div>';
                $("#logged_in_div").append(sh);
                return;
            }
            for(var i = 0; i < data.length; ++i) {
                var alt;
                if(typeof(data[i].title) !== 'undefined' && data[i].title)
                    alt = data[i].title;
                else
                    alt = data[i]['url'].replace(/https?:\/\//i, "").substr(0, 20) + '...';
                sh += '<tr id="tr-subscription-' + data[i].pid + '"><td><a href="' + data[i].url + '"><img src="' + data[i].image + '" alt="' + alt + '" title="' + alt + '"/><br><span>' + alt + '</span></a></td>';
                sh += '<td class="price-td" contenteditable="true" title="Click to change" data-pid="' + data[i].pid + '" data-store="' + data[i].store + '" data-userId="' + userId + '">' + data[i].price + '</td>';
                sh += '<td><a href="#" class="delete-subscription" data-pid="' + data[i].pid + '" data-userId="' + userId + '">Delete</a></td></tr>';
            }
            sh += '</table></div></div>';
            */
            $("#subscribed_prod").append(sh);
        }
    });
};

function checklogin() {
    $.get("https://flipshope.com/login/getUserData.php").done(function(data) {
        if (data["success"] == true) {
            if (data["validated"] == 1) {
                loggedinpage(data["uid"], data["email"], data["name"]);
                fetchUserSubscriptions(data["uid"]);
            } else if (data["mobile_validated"] == 0) {
                $('#user_form').html(ver_form);
                ver_validate(data["mobile"]);
            } else if (data["email_validated"] == 0) {
                $('#user_form').html(email_not_vali);
                email_not_validate();
            }
        }
    });
}

function loggedinpage(id, mail, name) {
    console.log(id.length);
    if (!(id.length == 10 || id.length == 8)) return false;
    console.log(2);
    if (localStorage['extid'].length == 8) localStorage['oldextid'] = localStorage['extid'];
    localStorage['extid'] = id;
    localStorage['islogin'] = 1;
    var loggedin = '<div class="luser_box" id="logged_in_div"><div ><div class="luser_subbox" ><h3 class="luser_h3_l" >Email</h3><h3 class="luser_h3_r" >' + mail + '</h3></div><div class="luser_sap" ></div></div><div ><div class="luser_subbox" ><h3 class="luser_h3_l" >Full Name</h3><h3 class="luser_h3_r" >' + name + '</h3></div></div></div><div id="subscribed_prod" class="luser_box"></div>';
    var extra = '<div class="luser_box"> <div> <div> <a href="https://chrome.google.com/webstore/detail/flipshope/adikhbfjdbjkhelbdnffogkobkekkkej/reviews?utm_source=chrome-ntp-icon" target="_blank"> <div class="luser_subbox"> <div class="luser_h3_l">Rate Flipshope</div><i class="luser_h3_r fa fa-1x fa-chevron-right"></i> </div></a> </div><div class="luser_sap"></div></div><div> <div> <a href="https://www.couponzila.com/reset-password.php" target="_blank"> <div class="luser_subbox"><div class="luser_h3_l">Change Password</div><i class="luser_h3_r fa fa-1x fa-chevron-right"></i> </div></a> </div><div class="luser_sap"></div></div><div> <div> <a href="https://flipshope.com/report" target="_blank"> <div class="luser_subbox"> <div class="luser_h3_l">Give Feedback</div><i class="luser_h3_r fa fa-1x fa-chevron-right"></i> </div></a> </div><div class="luser_sap"></div></div><div> <div class="luser_subbox" id="logout" style=" cursor: pointer;"> <h3 class="luser_h3_l">Logout</h3></div></div><div class="luser_sap"></div></div>';
    $('#user').html(loggedin + extra);
    $('#logout').click(function() {
        $.post("https://flipshope.com/login/logout.php").done(function() {
            window.location.href = window.location.href;
        });
    });
}

function signup_validate() {
    $('#signup_form').validate({
        rules: {
            name: {
                required: true,
                minlength: 3
            },
            email: {
                required: true,
                minlength: 3,
                email: true
            },
            mobile: {
                required: true,
                minlength: 10,
                maxlength: 10,
                digits: true
            },
            password: {
                required: true,
                minlength: 6,
                maxlength: 20
            },
            cpassword: {
                required: true,
                minlength: 6,
                maxlength: 20,
                equalTo: "#su_password"
            }
        },
        onfocusout: function(element) {
            this.element(element);
        },
        submitHandler: function(form) {
            $('#signup_form input[type="submit"]').addClass('disable');
            $.post("https://flipshope.com/login/signup.php", $("#signup_form").serialize()).done(function(data) {
                if (!data) return;
                if (data['success'] == true) {
                    $('#user_form').html('<div style=" padding: 135px 30px;font-size: 20px;color: green;">You have registered successfully, Please check your mail to activate the account and login</div>');
                } else {
                    $('#signup_form input[type="submit"]').removeClass('disable');
                    $('#signup_form div.error').html(data['message']);
                }
            });
            return false;
        }
    });
}

function login_validate() {
    $('#login_form').validate({
        rules: {
            user: {
                required: true,
                minlength: 3,
                email: true
            },
            pass: {
                required: true,
                minlength: 8,
                maxlength: 20
            }
        },
        onfocusout: function(element) {
            this.element(element);
        },
        submitHandler: function(form) {
            $('#login_form input[type="submit"]').addClass('disable');
            $.post("https://flipshope.com/login/login.php", $("#login_form").serialize()).done(function(data) {
                data = JSON.parse(data);
                if (!data) return;
                if (data['SUCCESS'] == true) {
                    checklogin();
                } else {
                    $('#login_form input[type="submit"]').removeClass('disable');
                    $('#login_form div.error').html(data['STATUS']);
                }
            });
            return false;
        }
    });
}

function fp_validate() {
    $('#fp_form').validate({
        rules: {
            user: {
                required: true,
                minlength: 3,
                email: true
            }
        },
        onfocusout: function(element) {
            this.element(element);
        },
        submitHandler: function(form) {
            $('#fp_form input[type="submit"]').addClass('disable');
            $('#fp_form div.error').html('');
            $('#fp_form div.success').html('');
            $.post("https://flipshope.com/login/generate_token.php", $("#fp_form").serialize()).done(function(data) {
                $('#fp_form input[type="submit"]').removeClass('disable');
                data = JSON.parse(data);
                if (!data) {
                    $('#fp_form div.error').html('Network error');
                } else if (data['SUCCESS'] == true) {
                    $('#fp_form div.success').html("OTP successfully sent to your mail id");
                } else {
                    $('#fp_form div.error').html(data['CAUSE']);
                }
            }).fail(function() {
                $('#fp_form input[type="submit"]').removeClass('disable');
                $('#fp_form div.error').html('Network error');
            });
            return false;
        }
    });
}

function ver_validate(mobile = 0) {
    if (mobile) {
        $('#ver_form input[name="phoneNo"]').val(mobile);
        $("#mobile_no_input_field").attr("disabled", "disabled");

    }
    $("#change_mobile").click(function() {
        $("#mobile_no_input_field").removeAttr("disabled");
        $('#mobile_no_input_field').val('');
        $('#mobile_no_input_field').focus().select();
    });
    $("#resend_otp").click(function() {
        send_otp();
    });
    $("#mobile_no_input_field").focusout(function() {
        send_otp();
    });

    function send_otp() {
        var phoneNo = $("#mobile_no_input_field").val();
        $('#ver_form div.error').html('');
        $('#ver_form div.success').html('');
        if (phoneNo.match(/^\d+$/) && phoneNo.length == 10) {
            $("#mobile_no_input_field").attr("disabled", "disabled");
            $.ajax({
                url: "https://flipshope.com/login/otp_generation.php",
                data: {
                    phoneNo: phoneNo
                },
                async: false,
                type: "POST",
                success: function(result) {
                    try {
                        var data = JSON.parse(result);
                    } catch (e) {
                        var data = [];
                        data['SUCCESS'] = false;
                        data['CAUSE'] = "Problem in sending OTP, Unknown error occurred";
                    }
                    if (data['SUCCESS'] == true) {
                        $('#ver_form div.success').html("OTP Sent");
                    } else {
                        $('#ver_form div.error').html("Problem in sending OTP, " + data['CAUSE']);
                    }

                },
                error: function() {
                    $('#ver_form div.error').html("Something went wrong, please try after sometime");
                },
                timeout: 3000
            });
        }
    }
    $('#ver_form').validate({
        rules: {
            phoneNo: {
                required: true,
                minlength: 10,
                maxlength: 10,
                digits: true
            },
            otp: {
                required: true,
                minlength: 6,
                maxlength: 6,
                digits: true
            },
        },
        onfocusout: function(element) {
            this.element(element);
        },
        submitHandler: function(form) {
            $('#ver_form input[type="submit"]').addClass('disable');
            $('#ver_form div.error').html('');
            $('#ver_form div.success').html('');
            $.post("https://flipshope.com/login/otp_validation.php", $("#ver_form").serialize()).done(function(data) {
                $('#ver_form input[type="submit"]').removeClass('disable');
                data = JSON.parse(data);
                if (!data) {
                    $('#ver_form div.error').html('Network error');
                } else if (data['SUCCESS'] == true) {
                    $('#ver_form div.success').html("Mobile number successfully verified");
                    checklogin();
                } else {
                    $('#ver_form div.error').html(data['CAUSE']);
                }
            }).fail(function() {
                $('#ver_form input[type="submit"]').removeClass('disable');
                $('#ver_form div.error').html('Network error');
            });
            return false;
        }
    });
}

function email_not_validate() {
    $('#email_not_vali').validate({
        submitHandler: function(form) {
            $('#email_not_vali input[type="submit"]').addClass('disable');
            $('#email_not_vali div.error').html('');
            $('#email_not_vali div.success').html('');
            $.post("https://flipshope.com/login/send_email_activation_mail.php", $("#email_not_vali").serialize()).done(function(data) {
                $('#email_not_vali input[type="submit"]').removeClass('disable');
                data = JSON.parse(data);
                if (!data) {
                    $('#email_not_vali div.error').html('Network error');
                } else if (data['SUCCESS'] == true) {
                    $('#email_not_vali div.success').html("Verification E-mail successfully send, Check youe inbox");
                } else {
                    $('#email_not_vali div.error').html(data['CAUSE']);
                }
            }).fail(function() {
                $('#email_not_vali input[type="submit"]').removeClass('disable');
                $('#email_not_vali div.error').html('Network error');
            });
            return false;
        }
    });
}

function getCookie(cvalue) {
    var name = cvalue + "=";
    var ca = document.cookie.split('; ');
    for (var i = 0; i < ca.length; i++) {
        var c = ca[i];
        if (c.indexOf(name) == 0) return c.split("=")[1];
    }
    return 0;
}

function autobuy(mobile, date) {
    date = new Date(date).getTime();
    if (document.getElementById(mobile).checked) {
        document.cookie = mobile + "=Yes;expires=" + new Date(getnextdate(date) + 120000);
        window.close();
        chrome.tabs.reload();
    }
    if (!document.getElementById(mobile).checked) {
        document.cookie = mobile + "=No;expires=" + new Date();
    }
}

//if(localStorage["pause"] == "true") {document.getElementById("pause").innerHTML = "Resume FlipShope"};
//if(localStorage["sicon"] == "true") document.getElementById("hide").innerHTML = "Show Icon";
//document.querySelector('#pause').addEventListener('click', pause);
//document.querySelector('#hide').addEventListener('click', hide);
(function(i, s, o, g, r, a, m) {
    i['GoogleAnalyticsObject'] = r;
    i[r] = i[r] || function() {
        (i[r].q = i[r].q || []).push(arguments)
    }, i[r].l = 1 * new Date();
    a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m)
})(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); // Note: https protocol here

ga('create', 'UA-54661846-1', 'auto');
ga('set', 'checkProtocolTask', function() {}); // Removes failing protocol check. @see: http://stackoverflow.com/a/22152353/1958200
ga('require', 'displayfeatures');
ga('send', 'pageview', '/options.html');
ga('set', 'transport', 'beacon');
ga('send', 'event', 'extension popup', 'open');